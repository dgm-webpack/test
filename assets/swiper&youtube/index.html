<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>使用swiper輪播影片及img</title>

    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.css">
    <link rel="stylesheet" href="https://unpkg.com/swiper/swiper-bundle.min.css">
    <link rel="stylesheet" href="main.min.css">
    <style>
        img {
            width: 100%;
        }
    </style>
</head>

<body class="">
    <div class="wrapper" id='digim'>
        <div class="video-swiper-wrapper">
            <div class="swiper-container swiper-youtube-container">
                <div id="mute-toggle"></div>
                <div class="swiper-wrapper">
                    <div class="swiper-slide">
                        <div class="video-container" data-id="reOFedz1URc" data-type="video">
                            <div class="video-iframe"></div>
                            <div class="video-play"></div>
                        </div>
                        <p class='title'>MAXTRA+ 雙濾芯全新上市 電視廣告</p>
                    </div>
                    <div class="swiper-slide">
                        <div class="video-container" data-id="LKh2GpXez9M" data-type="video">
                            <div class="video-iframe"></div>
                            <div class="video-play"></div>
                        </div>
                        <p class='title'>MAXTRA+ 濾芯-全效型 實驗影片</p>
                    </div>
                    <div class="swiper-slide">
                        <div class="img-container" data-type="img">
                            <img src="sec01.jpg" alt="">
                        </div>

                        <p class='title'>MAXTRA+ 濾芯-去水垢專家 實驗影片</p>
                    </div>
                    
                </div>

            </div>
            <div class="swiper-button-prev"> prev </div>
            <div class="swiper-button-next"> next </div>
            <div class="swiper-pagination"></div>
            
        </div>
        
    </div>
    

    <div class="ans"></div>




    <!-- swiper6 -->
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>

    <script src="https://unpkg.com/swiper/swiper-bundle.js"> </script>
    <script src="https://unpkg.com/swiper/swiper-bundle.min.js"> </script>
    <!-- <script src="main.js"></script> -->
    <script>
        // window.dataLayer = window.dataLayer || [];
        // function ptag() { dataLayer.push(arguments); }
        // ptag({ 'paid': '1568258659953' });
        // ptag('event', 'tracking', {
        //     'tracking_id': 'TAC20190912000000001'
        // });   
    </script>

    <script>
        var ytplayer, isMute = true,timeID

        // jQuery(function ($) {

            // if ($('.video-swiper-wrapper').length > 0) {
                var tag = document.createElement('script');
                tag.src = "https://www.youtube.com/iframe_api";
                var firstScriptTag = document.getElementsByTagName('script')[0];
                firstScriptTag.parentNode.insertBefore(tag, firstScriptTag);
            // }

            var initPlayer = function (element) {
                var player = element.querySelector('.video-iframe');
                var button = element.querySelector('.video-play');
                if (player) {
                    //console.log("video")
                    ytplayer = new YT.Player(player, {
                        playerVars: {
                            'mute': 1,
                            'autoplay': 1,
                            'modestbranding': 1,
                            'controls': 1,
                            'rel': 0,
                            'autohide': 0
                        },
                        videoId: element.dataset.id,
                        events: {
                            'onStateChange': onPlayerStateChange, //當播放器狀態改變時執行
                            //'onPlaybackMuteChange' : dddd
                        }
                    });
                } else {
                    console.log("img")
                    
                }

            };
            window.onYouTubePlayerAPIReady = function () {
                var container = document.querySelectorAll('.video-container');
                for (var i = 0; i < container.length; i++) {
                    initPlayer(container[i])
                }
            };


            
            var titles = ['Page 1', 'Page 2', 'Page 3'];
            var swiper_youtube = new Swiper('.swiper-youtube-container', {
                loop: true,  // 循環
                init: true,
                slidesPerView : 1, 
                slidesPerGroup : 1, 
                //autoplay : true, //自動播放
                navigation: {
                    nextEl: '.swiper-button-next',
                    prevEl: '.swiper-button-prev',
                },
                pagination: {
                    el: '.swiper-pagination',
                    type: 'bullets',
                    clickable: true,
                },
                lazy: {
                    loadPrevNext: true,
                },
                paginationBulletRender: function (index, className) {
                    return '<span class="' + className + '">' + titles[index] + '</span>';
                },
                on: {
                    init: function (swiper) {
                        //Swiper初始化了
                        //alert('当前的slide序号是' + this.activeIndex);//或者swiper.activeIndex，swiper与this都可指代当前swiper实例
                        //this.emit('transitionEnd');//在初始化时触发一次transitionEnd事件，需要先设置transitionEnd
                    },
                }
            }).on('slideChange', function () {
                let isVideo_activeIndex = swiper_youtube.slides[swiper_youtube.activeIndex]
                let isVideo_previousIndex = swiper_youtube.slides[swiper_youtube.previousIndex]
                window.clearTimeout(timeID);
                //console.log(isVideo_activeIndex.children[0].dataset.type)
                if (isVideo_previousIndex.children[0].dataset.type == "video") {

                    var isVideo = swiper_youtube.slides[swiper_youtube.previousIndex].querySelector('.video-container');
                    if (isVideo) {
                        YT.get(isVideo_previousIndex.querySelector('iframe').id).stopVideo();
                        // console.log(isVideo.querySelector('iframe').id);
                    }
                }
                if (isVideo_activeIndex.children[0].dataset.type == "img") {
                    document.querySelector("#mute-toggle").style.display = "none"
                    timeID = window.setTimeout(function () {
                        console.log('圖片5秒換下')
                        swiper_youtube.slideNext();
                    }, 5000)
                    return
                }
                if (isVideo_activeIndex.children[0].dataset.type == "video") {
                    var isVideo = swiper_youtube.slides[swiper_youtube.activeIndex].querySelector('.video-container');
                    document.querySelector("#mute-toggle").style.display = "block"
                    if (isVideo) {
                        console.log(isVideo_activeIndex.querySelector('iframe').id)
                        if (isMute) {
                            YT.get(isVideo_activeIndex.querySelector('iframe').id).mute();
                            document.querySelector(".ans").textContent = isMute

                        }
                        else {
                          
                            YT.get(isVideo_activeIndex.querySelector('iframe').id).unMute();
                            //sconsole.log('不靜音')
                            document.querySelector(".ans").textContent = isMute

                        }
                        YT.get(isVideo_activeIndex.querySelector('iframe').id).playVideo();

                        // console.log(isVideo.querySelector('iframe').id);
                    }
                }
            });

            document.querySelector("#mute-toggle").addEventListener('click', function () {
                //console.log(!!ytplayer.isMuted())
                isMute = !isMute
                var isVideo_activeIndex = swiper_youtube.slides[swiper_youtube.activeIndex].querySelector('.video-container');
                //YT.get(isVideo_activeIndex.querySelector('iframe').id).stopVideo();
                    document.querySelector(".ans").textContent = isMute

                    if (isMute) {
                        YT.get(isVideo_activeIndex.querySelector('iframe').id).mute();
                        document.querySelector(".ans").textContent = isMute

                    }
                    else {

                        YT.get(isVideo_activeIndex.querySelector('iframe').id).unMute();
                        //sconsole.log('不靜音')
                        document.querySelector(".ans").textContent = isMute

                    }
            })


            function dddd(){
                alert('hi')
            }

            function onPlayerStateChange(event) {
                // let isVideo_activeIndex = swiper_youtube.slides[swiper_youtube.activeIndex]
                // var isVideo = swiper_youtube.slides[swiper_youtube.activeIndex].querySelector('.video-container');
                console.log(event.data)
                if (event.data === 0) {

                    console.log('播完換下一部')
                    swiper_youtube.slideNext();
                    

                } else if (event.data === 1) {
                    
                }

            }

            // if ($('.video-swiper-wrapper .swiper-slide').length < 2) {
            //     $('.video-ctrl').hide();
            // }



        // });
    </script>

</body>

</html>